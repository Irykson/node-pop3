{"version":3,"file":"pop.js","names":["value","then","direct","Promise","resolve","body","result","recover","e","f","args","i","arguments","length","apply","reject","process","argv","options","alias","c","u","p","h","m","requiredOptionNames","mailStructure","port","tls","mailStructureOptionNames","printHelpAndExit","text","console","log","exit","optionName","slice","some","arg","charAt","replace","hasOwnProperty","call","error","push","help","config","configOptions","require","pathResolve","cwd","forEach","requiredOptionName","timeout","parseFloat","_optionName","pop3Command","Pop3Command","method","methodName","includes","_connect","command","info","stream","stream2String","str","QUIT","err","dir"],"sources":["index.mjs"],"sourcesContent":["#!/usr/bin/env node\nimport {resolve as pathResolve} from 'path';\nimport Pop3Command from '../lib/Command';\n\nimport {stream2String} from '../lib/helper';\n\nconst {argv} = process,\n  options = {},\n  alias = {\n    c: 'config',\n    u: 'user',\n    p: 'password',\n    h: 'host',\n    m: 'method',\n  },\n  requiredOptionNames = ['user', 'password', 'host', 'method'],\n  mailStructure = {\n    port: 110,\n    tls: false,\n  },\n  mailStructureOptionNames = ['user', 'password', 'host', 'port', 'tls', 'timeout'];\n\nfunction printHelpAndExit() {\n  const text = 'Usage: pop [options]\\r\\n'\n           + '\\r\\n'\n           + 'Example: pop -u example@gmail.com -p pwd -h example.pop3.com -m UIDL\\r\\n'\n           + '\\r\\n'\n           + 'Options:\\r\\n'\n           + '  -c, --config      config file (in place of options below)\\r\\n'\n           + '  -u, --user        username\\r\\n'\n           + '  -p, --password    password\\r\\n'\n           + '  -h, --host        host of server\\r\\n'\n           + '  --port            port of server. Defaults to 110 or 995 if tls is used.\\r\\n'\n           + '  --tls             whether to use TLS(SSL). Defaults to false.\\r\\n'\n           + '  --no-tls          disables previously set TLS(SSL).\\r\\n'\n           + '  -m, --method      method and arguments of API in node-pop3. e.g. \\'UIDL\\', \\'RETR 100\\' or \\'command USER example@gmail.com\\'\\r\\n'\n           + '  --help            print help';\n  console.log(text);\n  process.exit(0);\n}\n\nlet optionName;\nif (argv.slice(2).some(function(arg, i, args) {\n  if (arg.charAt(0) === '-') {\n    optionName = arg.replace(/^-+/g, '');\n    if ((optionName || '').length === 1) {\n      if (!{}.hasOwnProperty.call(alias, optionName)) {\n        console.error('Invalid alias', optionName);\n        return true;\n      }\n      optionName = alias[optionName];\n    }\n    if (\n      optionName &&\n      (i === args.length - 1 || args[i + 1].charAt(0) === '-')\n    ) {\n      options[optionName] = [true];\n    }\n  } else if (!optionName) {\n    console.error('Invalid argument', arg);\n    return true;\n  } else if (options[optionName]) {\n    options[optionName].push(arg);\n  } else {\n    options[optionName] = [arg];\n  }\n})) {\n  process.exit();\n}\n\nif (options.help) {\n  printHelpAndExit();\n}\n\nif (options.config) {\n  const configOptions = require(pathResolve(process.cwd(), options.config[0]));\n  ['method', ...mailStructureOptionNames].forEach((optionName) => {\n    if (!(optionName in options) && optionName in configOptions) {\n      options[optionName] = [configOptions[optionName]];\n    }\n  });\n}\n\nfor (const requiredOptionName of requiredOptionNames) {\n  if (!options[requiredOptionName]) {\n    console.error(requiredOptionName + ' is required!');\n    printHelpAndExit();\n  }\n}\n\nif (options.timeout) {\n  options.timeout[0] = parseFloat(options.timeout[0]);\n}\n\nif ('no-tls' in options) {\n  options.tls = [false];\n} else if (options.tls && options.tls[0]) {\n  // By using `mailStructure`, can still be overridden below\n  mailStructure.port = '995';\n}\nfor (const _optionName of mailStructureOptionNames) {\n  mailStructure[_optionName] = (\n    options[_optionName] || []\n  )[0] || mailStructure[_optionName];\n}\n\nconst pop3Command = new Pop3Command(mailStructure);\nconst [methodName] = options.method;\n\n// Todo: Might want to report this to Istnabul as nyc doesn't seem to pick\n//   this up, despite it running\n// istanbul ignore next\n(async () => {\n\nlet result;\ntry {\n  if (['UIDL', 'TOP', 'QUIT', 'RETR'].includes(methodName)) {\n    result = await pop3Command[methodName](...options.method.slice(1));\n  } else {\n    await pop3Command._connect();\n    result = await pop3Command.command(...options.method);\n    if (result[1]) {\n      const [info, stream] = result;\n      const str = await stream2String(stream);\n      result = [info, str];\n    }\n  }\n  if (methodName !== 'QUIT') {\n    await pop3Command.QUIT();\n  }\n} catch (err) {\n  console.error(err);\n  process.exit();\n}\n\nconsole.dir(result);\nprocess.exit(0);\n\n})();\n"],"mappings":"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"}