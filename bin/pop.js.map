{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"pop.js","sourcesContent":["#!/usr/bin/env node\nimport {resolve as pathResolve} from 'path';\nimport 'regenerator-runtime/runtime.js';\nimport Pop3Command from '../lib/Command';\n\nimport {stream2String} from '../lib/helper';\n\nconst {argv} = process,\n  options = {},\n  alias = {\n    c: 'config',\n    u: 'user',\n    p: 'password',\n    h: 'host',\n    m: 'method',\n  },\n  requiredOptionNames = ['user', 'password', 'host', 'method'],\n  mailStructure = {\n    port: 110,\n    tls: false,\n  },\n  mailStructureOptionNames = ['user', 'password', 'host', 'port', 'tls', 'timeout'];\n\nfunction printHelpAndExit() {\n  const text = 'Usage: pop [options]\\r\\n'\n           + '\\r\\n'\n           + 'Example: pop -u example@gmail.com -p pwd -h example.pop3.com -m UIDL\\r\\n'\n           + '\\r\\n'\n           + 'Options:\\r\\n'\n           + '  -c, --config      config file (in place of options below)\\r\\n'\n           + '  -u, --user        username\\r\\n'\n           + '  -p, --password    password\\r\\n'\n           + '  -h, --host        host of server\\r\\n'\n           + '  --port            port of server. Defaults to 110 or 995 if tls is used.\\r\\n'\n           + '  --tls             whether to use TLS(SSL). Defaults to false.\\r\\n'\n           + '  -m, --method      method and arguments of API in node-pop3. e.g. \\'UIDL\\', \\'RETR 100\\' or \\'command USER example@gmail.com\\'\\r\\n'\n           + '  --help            print help';\n  console.log(text);\n  process.exit(0);\n}\n\nlet optionName;\nif (argv.slice(2).some(function(arg, i, args) {\n  if (arg.charAt(0) === '-') {\n    optionName = arg.replace(/-/g, '');\n    if ((optionName || ' ').length === 1) {\n      if (!{}.hasOwnProperty.call(alias, optionName)) {\n        console.error('Invalid alias', optionName);\n        return true;\n      }\n      optionName = alias[optionName];\n    }\n    if (i === args.length - 1) {\n      options[optionName] = [true];\n    }\n  } else if (!optionName) {\n    console.error('Invalid argument', arg);\n    return true;\n  } else if (options[optionName]) {\n    options[optionName].push(arg);\n  } else {\n    options[optionName] = [arg];\n  }\n})) {\n  process.exit();\n}\n\nif (options.help) {\n  printHelpAndExit();\n}\n\nif (options.config) {\n  const configOptions = require(pathResolve(process.cwd(), options.config[0]));\n  ['method', ...mailStructureOptionNames].forEach((optionName) => {\n    if (!(optionName in options) && optionName in configOptions) {\n      options[optionName] = [configOptions[optionName]];\n    }\n  });\n}\n\nfor (const requiredOptionName of requiredOptionNames) {\n  if (!options[requiredOptionName]) {\n    console.error(requiredOptionName + ' is required!');\n    printHelpAndExit();\n  }\n}\n\nif (options.timeout) {\n  options.timeout[0] = parseFloat(options.timeout[0]);\n}\n\nif (options.tls && options.tls[0]) {\n  mailStructure.port = '995';\n}\nfor (const _optionName of mailStructureOptionNames) {\n  mailStructure[_optionName] = (options[_optionName] || [])[0] || mailStructure[_optionName];\n}\n\nconst pop3Command = new Pop3Command(mailStructure),\n  [methodName] = options.method;\n\n(async () => {\n\nlet result;\nif (['UIDL', 'TOP', 'QUIT', 'RETR'].includes(methodName)) {\n  result = await pop3Command[methodName](...options.method.slice(1));\n  if (methodName === 'RETR') {\n    result = await stream2String(result);\n  }\n} else {\n  await pop3Command._connect();\n  result = await pop3Command.command(...options.method);\n  if (result[1]) {\n    const [info, stream] = result;\n    const str = await stream2String(stream);\n    result = [info, str];\n  }\n}\n\nconsole.dir(result);\nprocess.exit(0);\n\n})();\n"]}